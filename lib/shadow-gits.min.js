// shadow-gits cdn ver 1.1.0
window.W||(window.W=new Array,W.$modules=[]),W.$modules.push(function(t,n,e){function i(t){return t?Array.isArray(t)?t:[t]:[]}function r(){return(new Date).toLocaleDateString().replace(/\//g,"-")}function o(t,n){return t.siteProtocol+"://"+t.siteDomain+("/"===n[0]?n:"/"+n)}function s(t,n,e){var i={type:"GET",dataType:"json",url:o(t,"/repos/"+n.user.login+"/"+n.repoName+"/contents/"+n.path),data:{_:(new Date).valueOf()+""},success:function(t,i,r){for(var o in t)n[o]=t[o];e&&e(null,n)},error:function(t,i){e&&e(new Error(i),n)}};t.siteAuth&&(i.headers={Authorization:t.siteAuth}),d.ajax(i)}function a(t,n,e,i,s,a,u,h){var c,f,l,p,m=r();if(u)c=(c=u.path)?c+"/"+n:n,f=u.branchName,l=u.repoName,p=u.user;else{if(!a)return;c=a.path,f=a.branchName,l=a.repoName,p=a.user}var v=void 0===e?h:w.encode(e);if(void 0!==v){var y={path:c,message:m,content:v,branch:f};i&&(y.sha=i);var N={type:"PUT",dataType:"json",url:o(t,"/repos/"+p.login+"/"+l+"/contents/"+c),data:y,success:function(i,r,o){var h=null,c=null;if(i.content&&"file"==i.content.type)if(h=new t.File(i.content,p,l,f),h.content=v,h.rawContent=e,u){var m=u.contents.findIndex(function(t){return t.name==n&&"file"==t.type});m>=0?u.contents.splice(m,1,h):u.contents.push(h)}else for(var d in h)h.hasOwnProperty(d)&&(a[d]=h[d]);i.commit&&t.Commit&&(c=new t.Commit(i.commit,p,l),h&&(h.sha&&(c.file_sha=h.sha),h.url&&(c.file_url=h.url))),s&&(h||((h=u?u.fileOf(n):a).content=v,h.rawContent=e),s(null,[h,c]))},error:function(t,n){s&&s(new Error(n),[null,null])}};t.siteAuth&&(N.headers={Authorization:t.siteAuth}),d.ajax(N)}}function u(t,n,e,i,s,a){var u,h,c,f,l=r();if(a)u=(u=a.path)?u+"/"+n:n,h=a.branchName,c=a.repoName,f=a.user;else{if(!s)return;u=s.path,h=s.branchName,c=s.repoName,f=s.user}var p={type:"DELETE",dataType:"json",url:o(t,"/repos/"+f.login+"/"+c+"/contents/"+u),data:{path:u,message:l,branch:h,sha:e},success:function(e,r,o){var u;if(a){var h=a.contents.findIndex(function(t){return t.name==n&&"file"==t.type});h>=0?(u=a.contents[h],a.contents.splice(h,1)):u=a.fileOf(n)}else u=s;if(i){var l=null;e.commit&&t.Commit&&(l=new t.Commit(e.commit,f,c)),i(null,[u,l])}},error:function(t,n){i&&i(new Error(n),[null,null])}};t.siteAuth&&(p.headers={Authorization:t.siteAuth}),d.ajax(p)}function h(t,n){"string"!=typeof t.content?t.fetchContent(function(e,i){e?n(e,i):n(null,t.content)}):n(null,t.content)}function c(t,n){"string"!=typeof t.content?t.fetchContent(function(e,i){e?n(e,i):(t.rawContent=w.decode(t.content),n(null,t.rawContent))}):("string"!=typeof t.rawContent&&(t.rawContent=w.decode(t.content)),n(null,t.rawContent))}function f(t,n,e){n.contents=[];var r={type:"GET",dataType:"json",url:o(t,"/repos/"+n.user.login+"/"+n.repoName+"/contents/"+n.path),data:{_:(new Date).valueOf()+"",ref:n.branchName},success:function(r,o,s){var a=n.contents;i(r).forEach(function(e){"file"==e.type&&a.push(new t.File(e,n.user,n.repoName,n.branchName)),"dir"==e.type&&a.push(new t.Dir(e,n.user,n.repoName,n.branchName))}),e&&e(null,n)},error:function(t,i){e&&e(new Error(i),n)}};t.siteAuth&&(r.headers={Authorization:t.siteAuth}),d.ajax(r)}function l(t,n,e,r,s,a){n.commits=[];var u={sha:n.branchName,_:(new Date).valueOf()+""};e&&(u.path=e),r&&(u.since=r),s&&(u.until=s);var h={type:"GET",dataType:"json",url:o(t,"/repos/"+n.user.login+"/"+n.repoName+"/commits"),data:u,success:function(e,r,o){var s=n.commits;i(e).forEach(function(e){if(e.commit){var i=new t.Commit(e.commit,n.user,n.repoName);e.sha&&(i.sha=e.sha),e.url&&(i.url=e.url),s.push(i)}}),a&&a(null,n)},error:function(t,e){a&&a(new Error(e),n)}};t.siteAuth&&(h.headers={Authorization:t.siteAuth}),d.ajax(h)}function p(t,n,e){e&&(t.create_by=e),b.forEach(function(e){t[e]=n[e]})}if(Array.prototype.findIndex||(Array.prototype.findIndex=function(t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),e=n.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<e;){var o=n[r];if(t.call(i,o,r,n))return r;r++}return-1}),!Array.prototype.find){var m=Array.prototype.findIndex;Array.prototype.find=function(){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=m.apply(t,arguments);return n>=0?t[n]:void 0}}var d=t("shadow-widget").$utils,w=d.Base64,v={},y={};d.gitOf=function(t,n){return t&&"string"==typeof t?0==t.indexOf("localhost")||0==t.indexOf("127.0.0.1")?(y.siteDomain=t,n&&(y.siteProtocol=n),y):(v.siteDomain=t,n&&(v.siteProtocol=n),v):v};var N=function(){};N.inherits=function(t,n,e){function i(t,n){for(var e in n)t[e]=n[e]}var r,o=function(){};return r=n&&n.hasOwnProperty("constructor")?n.constructor:function(){t.apply(this,arguments)},i(r,t),o.prototype=t.prototype,r.prototype=new o,n&&i(r.prototype,n),e&&i(r,e),r.prototype.constructor=r,r.__super__=t.prototype,r},N.extend=function(t,n){var e=N.inherits(this,t,n);return e.extend=this.extend,e};var A=N.extend({constructor:function(t,n,e,i){if(t)for(var r in t)this[r]=t[r];n&&(this.user=n),e&&(this.repoName=e),i&&(this.branchName=i)}},{});v.siteProtocol="https",v.siteDomain="api.github.com",v.siteAuth="",v.User=N.extend({constructor:function(t,n){if(n)for(var e in n)this[e]=n[e];if(!t)throw"invalid name";this.login=t,this.isLocal=!1},fetch:function(t){var n=this,e={type:"GET",dataType:"json",url:o(v,"/users/"+this.login),data:{_:(new Date).valueOf()+""},success:function(e,i,r){for(var o in e)n[o]=e[o];t&&t(null,n)},error:function(e,i){t&&t(new Error(i),n)}};v.siteAuth&&(e.headers={Authorization:v.siteAuth}),d.ajax(e)}},{}),v.Commit=N.extend({constructor:function(t,n,e){for(var i in t)this[i]=t[i];n&&(this.user=n),e&&(this.repoName=e)}},{}),v.File=A.extend({constructor:function(t,n,e,i){if(!e)throw"invalid repository";if(!i)throw"invalid branch";if(v.File.__super__.constructor.call(this,t,n,e,i),"string"!=typeof this.path)throw"invalid path";this.name||(this.name=this.path.split("/").pop())},fetchContent:function(t){s(v,this,t)},fetchCommits:function(t,n,e){l(v,this,this.path,n,e,t)},putContent:function(t,n,e){if(!this.sha)throw"no sha";a(v,this.name,t,this.sha,n,this,null,e)},remove:function(t){if(!this.sha)throw"no sha";u(this.name,this.sha,t,this,null)},readContent:function(t){h(this,t)},readRaw:function(t){c(this,t)}},{}),v.Dir=A.extend({constructor:function(t,n,e,i){if(!e)throw"invalid repository";if(!i)throw"invalid branch";if(this.contents=[],v.Dir.__super__.constructor.call(this,t,n,e,i),"string"!=typeof this.path)throw"invalid path"},fetchContents:function(t){f(v,this,t)},newFile:function(t,n,e,i){a(v,t,n,"",e,null,this,i)},putFile:function(t,n,e,i,r){if(i||this.getFile(t)&&(i=file.sha),!i)throw"invalid sha";a(v,t,n,i,e,null,this,r)},removeFile:function(t,n,e){if(!e){var i=this.getFile(t);if(!i)throw"unknown file";e=i.sha}if(!e)throw"invalid sha";u(t,e,n,null,this)},dirOf:function(t){var n=this.path;return n=n?n+"/"+t:t,new v.Dir({path:n},this.user,this.repoName,this.branchName)},fileOf:function(t){var n=this.path;return n=n?n+"/"+t:t,new v.File({path:n},this.user,this.repoName,this.branchName)},getFile:function(t){return this.contents.find(function(n){return n.name==t&&"file"==n.type})},getDir:function(t){return this.contents.find(function(n){return n.name==t&&"dir"==n.type})}},{}),v.Branch=N.extend({constructor:function(t,n,e){if(!n)throw"invalid repository";if(!e)throw"invalid branch";t&&(this.user=t),this.isLocal=!1,this.repoName=n,this.branchName=e,this.commits=[]},fetchCommits:function(t,n,e){l(v,this,"",n,e,t)},dirOf:function(t){return new v.Dir({path:t},this.user,this.repoName,this.branchName)},fileOf:function(t){return new v.File({path:t},this.user,this.repoName,this.branchName)},fetchIssues:function(t,n){var e=Object.assign({_:(new Date).valueOf()+""},n),i=this,r={type:"GET",dataType:"json",url:o(v,"/repos/"+this.user.login+"/"+this.repoName+"/issues"),data:e,success:function(n,e,r){i.issues=[],Array.isArray(n)&&n.forEach(function(t){i.issues.push(new v.Issue(i.user,i.repoName,t.number,t))}),t&&t(null,i)},error:function(n,e){t&&t(new Error(e),i)}};v.siteAuth&&(r.headers={Authorization:v.siteAuth}),d.ajax(r)},createIssue:function(t,n){var e={type:"POST",dataType:"json",url:o(v,"/repos/"+this.user.login+"/"+this.repoName+"/issues"),data:n,success:function(n,e,i){t&&t(null,n)},error:function(n,e){t&&t(new Error(e),null)}};v.siteAuth&&(e.headers={Authorization:v.siteAuth}),d.ajax(e)}},{});var b=["id","title","labels","state","locked","comments","created_at","updated_at","closed_at","body","closed_by"];v.Issue=N.extend({constructor:function(t,n,e,i){if(!n)throw"invalid repository";t&&(this.user=t),"number"==typeof e&&(this.number=e),this.repoName=n,this.comments=[],i&&p(this,i,i.user)},fetchContents:function(t){var n=this,e={type:"GET",dataType:"json",url:o(v,"/repos/"+this.user.login+"/"+this.repoName+"/issues/"+this.number),data:{_:(new Date).valueOf()+""},success:function(e,i,r){p(n,e,e.user),t&&t(null,n)},error:function(e,i){t&&t(new Error(i),n)}};v.siteAuth&&(e.headers={Authorization:v.siteAuth}),d.ajax(e)},fetchComments:function(t){var n=this,e={type:"GET",dataType:"json",url:o(v,"/repos/"+this.user.login+"/"+this.repoName+"/issues/"+this.number+"/comments"),data:{_:(new Date).valueOf()+""},success:function(n,e,i){t&&t(null,n)},error:function(e,i){t&&t(new Error(i),n)}};v.siteAuth&&(e.headers={Authorization:v.siteAuth}),d.ajax(e)},fetchEvents:function(t){var n=this,e={type:"GET",dataType:"json",url:o(v,"/repos/"+this.user.login+"/"+this.repoName+"/issues/"+this.number+"/events"),data:{_:(new Date).valueOf()+""},success:function(n,e,i){t&&t(null,n)},error:function(e,i){t&&t(new Error(i),n)}};v.siteAuth&&(e.headers={Authorization:v.siteAuth}),d.ajax(e)}},{}),y.siteProtocol="http",y.siteDomain="localhost:3000",y.siteAuth="",y.User=N.extend({constructor:function(t,n){if(n)for(var e in n)this[e]=n[e];if(!t)throw"invalid name";this.login=t,this.isLocal=!0},fetch:function(t){t&&t(null,self)}},{}),y.Commit=null,y.File=A.extend({constructor:function(t,n,e,i){if(!e)throw"invalid repository";if(!i)throw"invalid branch";if(y.File.__super__.constructor.call(this,t,n,e,i),"string"!=typeof this.path)throw"invalid path";this.name||(this.name=this.path.split("/").pop())},fetchContent:function(t){s(y,this,t)},fetchCommits:function(t,n,e){t&&t(null,this)},putContent:function(t,n,e){a(y,this.name,t,"",n,this,null,e)},remove:function(t){u(y,this.name,"",t,this,null)},readContent:function(t){h(this,t)},readRaw:function(t){c(this,t)}},{}),y.Dir=A.extend({constructor:function(t,n,e,i){if(!e)throw"invalid repository";if(!i)throw"invalid branch";if(this.contents=[],y.Dir.__super__.constructor.call(this,t,n,e,i),"string"!=typeof this.path)throw"invalid path"},fetchContents:function(t){f(y,this,t)},newFile:function(t,n,e,i){a(y,t,n,"",e,null,this,i)},putFile:function(t,n,e,i){a(y,t,n,"",e,null,this,i)},removeFile:function(t,n){u(y,t,"",n,null,this)},dirOf:function(t){var n=this.path;return n=n?n+"/"+t:t,new y.Dir({path:n},this.user,this.repoName,this.branchName)},fileOf:function(t){var n=this.path;return n=n?n+"/"+t:t,new y.File({path:n},this.user,this.repoName,this.branchName)},getFile:function(t){return this.contents.find(function(n){return n.name==t&&"file"==n.type})},getDir:function(t){return this.contents.find(function(n){return n.name==t&&"dir"==n.type})}},{}),y.Branch=N.extend({constructor:function(t,n,e){if(!n)throw"invalid repository";if(!e)throw"invalid branch";t&&(this.user=t),this.isLocal=!0,this.repoName=n,this.branchName=e,this.commits=[]},fetchCommits:function(t,n,e){t&&t(null,this)},dirOf:function(t){return new y.Dir({path:t},this.user,this.repoName,this.branchName)},fileOf:function(t){return new y.File({path:t},this.user,this.repoName,this.branchName)}},{})});