// shadow-gits cdn ver 0.1.0
window.W||(window.W=new Array,W.$modules=[]),W.$modules.push(function(a,b,c){function k(a){return a?Array.isArray(a)?a:[a]:[]}function l(){return(new Date).toLocaleDateString().replace(/\//g,"-")}function m(a,b){return a.siteProtocol+"://"+a.siteDomain+("/"===b[0]?b:"/"+b)}function n(a,b,c){var d={type:"GET",dataType:"json",url:m(a,"/repos/"+b.user.login+"/"+b.repoName+"/contents/"+b.path),data:{_:(new Date).valueOf()+""},success:function(a,d,e){for(var f in a)b[f]=a[f];c&&c(null,b)},error:function(a,d){c&&c(new Error(d),b)}};a.siteAuth&&(d.headers={Authorization:a.siteAuth}),e.ajax(d)}function o(a,b,c,d,g,h,i,j){var k,n,o,p,q=l();if(i)k=i.path,k=k?k+"/"+b:b,n=i.branchName,o=i.repoName,p=i.user;else{if(!h)return;k=h.path,n=h.branchName,o=h.repoName,p=h.user}var r=void 0===c?j:f.encode(c);if(void 0!==r){var s={path:k,message:q,content:r,branch:n};d&&(s.sha=d);var t={type:"PUT",dataType:"json",url:m(a,"/repos/"+p.login+"/"+o+"/contents/"+k),data:s,success:function(d,e,f){var j=null,k=null;if(d.content&&"file"==d.content.type)if(j=new a.File(d.content,p,o,n),j.content=r,j.rawContent=c,i){var l=i.contents.findIndex(function(a){return a.name==b&&"file"==a.type});l>=0?i.contents.splice(l,1,j):i.contents.push(j)}else for(var m in j)j.hasOwnProperty(m)&&(h[m]=j[m]);d.commit&&a.Commit&&(k=new a.Commit(d.commit,p,o),j&&(j.sha&&(k.file_sha=j.sha),j.url&&(k.file_url=j.url))),g&&(j||(j=i?i.fileOf(b):h,j.content=r,j.rawContent=c),g(null,[j,k]))},error:function(a,b){g&&g(new Error(b),[null,null])}};a.siteAuth&&(t.headers={Authorization:a.siteAuth}),e.ajax(t)}}function p(a,b,c,d,f,g){var h,i,j,k,n=l();if(g)h=g.path,h=h?h+"/"+b:b,i=g.branchName,j=g.repoName,k=g.user;else{if(!f)return;h=f.path,i=f.branchName,j=f.repoName,k=f.user}var o={type:"DELETE",dataType:"json",url:m(a,"/repos/"+k.login+"/"+j+"/contents/"+h),data:{path:h,message:n,branch:i,sha:c},success:function(c,e,h){var i;if(g){var l=g.contents.findIndex(function(a){return a.name==b&&"file"==a.type});l>=0?(i=g.contents[l],g.contents.splice(l,1)):i=g.fileOf(b)}else i=f;if(d){var m=null;c.commit&&a.Commit&&(m=new a.Commit(c.commit,k,j)),d(null,[i,m])}},error:function(a,b){d&&d(new Error(b),[null,null])}};a.siteAuth&&(o.headers={Authorization:a.siteAuth}),e.ajax(o)}function q(a,b){"string"!=typeof a.content?a.fetchContent(function(c,d){c?b(c,d):b(null,a.content)}):b(null,a.content)}function r(a,b){"string"!=typeof a.content?a.fetchContent(function(c,d){c?b(c,d):(a.rawContent=f.decode(a.content),b(null,a.rawContent))}):("string"!=typeof a.rawContent&&(a.rawContent=f.decode(a.content)),b(null,a.rawContent))}function s(a,b,c){b.contents=[];var d={type:"GET",dataType:"json",url:m(a,"/repos/"+b.user.login+"/"+b.repoName+"/contents/"+b.path),data:{_:(new Date).valueOf()+"",ref:b.branchName},success:function(d,e,f){var g=b.contents;k(d).forEach(function(c){"file"==c.type&&g.push(new a.File(c,b.user,b.repoName,b.branchName)),"dir"==c.type&&g.push(new a.Dir(c,b.user,b.repoName,b.branchName))}),c&&c(null,b)},error:function(a,d){c&&c(new Error(d),b)}};a.siteAuth&&(d.headers={Authorization:a.siteAuth}),e.ajax(d)}function t(a,b,c,d,f,g){b.commits=[];var h={sha:b.branchName,_:(new Date).valueOf()+""};c&&(h.path=c),d&&(h.since=d),f&&(h.until=f);var i={type:"GET",dataType:"json",url:m(a,"/repos/"+b.user.login+"/"+b.repoName+"/commits"),data:h,success:function(c,d,e){var f=b.commits;k(c).forEach(function(c){if(c.commit){var d=new a.Commit(c.commit,b.user,b.repoName);c.sha&&(d.sha=c.sha),c.url&&(d.url=c.url),f.push(d)}}),g&&g(null,b)},error:function(a,c){g&&g(new Error(c),b)}};a.siteAuth&&(i.headers={Authorization:a.siteAuth}),e.ajax(i)}var d=a("shadow-widget"),e=d.$utils,f=e.Base64,g={},h={};e.gitOf=function(a,b){return a&&"string"==typeof a?a.startsWith("localhost")||a.startsWith("127.0.0.1")?(h.siteDomain=a,b&&(h.siteProtocol=b),h):(g.siteDomain=a,b&&(g.siteProtocol=b),g):g};var i=function(){};i.inherits=function(a,b,c){function f(a,b){for(var c in b)a[c]=b[c]}var d,e=function(){};return d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)},f(d,a),e.prototype=a.prototype,d.prototype=new e,b&&f(d.prototype,b),c&&f(d,c),d.prototype.constructor=d,d.__super__=a.prototype,d},i.extend=function(a,b){var c=i.inherits(this,a,b);return c.extend=this.extend,c};var j=i.extend({constructor:function(a,b,c,d){if(a)for(var e in a)this[e]=a[e];b&&(this.user=b),c&&(this.repoName=c),d&&(this.branchName=d)}},{});g.siteProtocol="https",g.siteDomain="api.github.com",g.siteAuth="",g.User=i.extend({constructor:function(a,b){if(b)for(var c in b)this[c]=b[c];if(!a)throw"invalid name";this.login=a,this.isLocal=!1},fetch:function(a){var b=this,c={type:"GET",dataType:"json",url:m(g,"/users/"+this.login),data:{_:(new Date).valueOf()+""},success:function(c,d,e){for(var f in c)b[f]=c[f];a&&a(null,b)},error:function(c,d){a&&a(new Error(d),b)}};g.siteAuth&&(c.headers={Authorization:g.siteAuth}),e.ajax(c)}},{}),g.Commit=i.extend({constructor:function(a,b,c){for(var d in a)this[d]=a[d];b&&(this.user=b),c&&(this.repoName=c)}},{}),g.File=j.extend({constructor:function(a,b,c,d){if(!c)throw"invalid repository";if(!d)throw"invalid branch";if(g.File.__super__.constructor.call(this,a,b,c,d),"string"!=typeof this.path)throw"invalid path";this.name||(this.name=this.path.split("/").pop())},fetchContent:function(a){n(g,this,a)},fetchCommits:function(a,b,c){t(g,this,this.path,b,c,a)},putContent:function(a,b,c){if(!this.sha)throw"no sha";o(g,this.name,a,this.sha,b,this,null,c)},remove:function(a){if(!this.sha)throw"no sha";p(this.name,this.sha,a,this,null)},readContent:function(a){q(this,a)},readRaw:function(a){r(this,a)}},{}),g.Dir=j.extend({constructor:function(a,b,c,d){if(!c)throw"invalid repository";if(!d)throw"invalid branch";if(this.contents=[],g.Dir.__super__.constructor.call(this,a,b,c,d),"string"!=typeof this.path)throw"invalid path"},fetchContents:function(a){s(g,this,a)},newFile:function(a,b,c,d){o(g,a,b,"",c,null,this,d)},putFile:function(a,b,c,d,e){if(!d){var f=this.getFile(a);f&&(d=file.sha)}if(!d)throw"invalid sha";o(g,a,b,d,c,null,this,e)},removeFile:function(a,b,c){if(!c){var d=this.getFile(a);if(!d)throw"unknown file";c=d.sha}if(!c)throw"invalid sha";p(a,c,b,null,this)},dirOf:function(a){var b=this.path;return b=b?b+"/"+a:a,new g.Dir({path:b},this.user,this.repoName,this.branchName)},fileOf:function(a){var b=this.path;return b=b?b+"/"+a:a,new g.File({path:b},this.user,this.repoName,this.branchName)},getFile:function(a){return this.contents.find(function(b){return b.name==a&&"file"==b.type})},getDir:function(a){return this.contents.find(function(b){return b.name==a&&"dir"==b.type})}},{}),g.Branch=i.extend({constructor:function(a,b,c){if(!b)throw"invalid repository";if(!c)throw"invalid branch";a&&(this.user=a),this.isLocal=!1,this.repoName=b,this.branchName=c,this.commits=[]},fetchCommits:function(a,b,c){t(g,this,"",b,c,a)},dirOf:function(a){return new g.Dir({path:a},this.user,this.repoName,this.branchName)},fileOf:function(a){return new g.File({path:a},this.user,this.repoName,this.branchName)}},{}),h.siteProtocol="http",h.siteDomain="localhost:3000",h.siteAuth="",h.User=i.extend({constructor:function(a,b){if(b)for(var c in b)this[c]=b[c];if(!a)throw"invalid name";this.login=a,this.isLocal=!0},fetch:function(a){a&&a(null,self)}},{}),h.Commit=null,h.File=j.extend({constructor:function(a,b,c,d){if(!c)throw"invalid repository";if(!d)throw"invalid branch";if(h.File.__super__.constructor.call(this,a,b,c,d),"string"!=typeof this.path)throw"invalid path";this.name||(this.name=this.path.split("/").pop())},fetchContent:function(a){n(h,this,a)},fetchCommits:function(a,b,c){a&&a(null,this)},putContent:function(a,b,c){o(h,this.name,a,"",b,this,null,c)},remove:function(a){p(h,this.name,"",a,this,null)},readContent:function(a){q(this,a)},readRaw:function(a){r(this,a)}},{}),h.Dir=j.extend({constructor:function(a,b,c,d){if(!c)throw"invalid repository";if(!d)throw"invalid branch";if(this.contents=[],h.Dir.__super__.constructor.call(this,a,b,c,d),"string"!=typeof this.path)throw"invalid path"},fetchContents:function(a){s(h,this,a)},newFile:function(a,b,c,d){o(h,a,b,"",c,null,this,d)},putFile:function(a,b,c,d){o(h,a,b,"",c,null,this,d)},removeFile:function(a,b){p(h,a,"",b,null,this)},dirOf:function(a){var b=this.path;return b=b?b+"/"+a:a,new h.Dir({path:b},this.user,this.repoName,this.branchName)},fileOf:function(a){var b=this.path;return b=b?b+"/"+a:a,new h.File({path:b},this.user,this.repoName,this.branchName)},getFile:function(a){return this.contents.find(function(b){return b.name==a&&"file"==b.type})},getDir:function(a){return this.contents.find(function(b){return b.name==a&&"dir"==b.type})}},{}),h.Branch=i.extend({constructor:function(a,b,c){if(!b)throw"invalid repository";if(!c)throw"invalid branch";a&&(this.user=a),this.isLocal=!0,this.repoName=b,this.branchName=c,this.commits=[]},fetchCommits:function(a,b,c){a&&a(null,this)},dirOf:function(a){return new h.Dir({path:a},this.user,this.repoName,this.branchName)},fileOf:function(a){return new h.File({path:a},this.user,this.repoName,this.branchName)}},{})});